<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema de Faturas - Vers√£o Completa</title>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 20px;
  min-height: 100vh;
}

.container {
  max-width: 900px;
  margin: auto;
}

h1 {
  text-align: center;
  color: white;
  margin-bottom: 30px;
  font-size: 2em;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
}

.card {
  background: white;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  margin-bottom: 25px;
  animation: fadeIn 0.5s;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}

h2 {
  color: #667eea;
  margin-bottom: 20px;
  font-size: 1.5em;
  display: flex;
  align-items: center;
  gap: 10px;
}

.form-group {
  margin-bottom: 15px;
}

label {
  display: block;
  margin-bottom: 5px;
  color: #333;
  font-weight: 500;
  font-size: 14px;
}

input, select, textarea {
  width: 100%;
  padding: 12px;
  border: 2px solid #e0e0e0;
  border-radius: 8px;
  font-size: 14px;
  transition: all 0.3s;
  font-family: inherit;
}

input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.btn {
  width: 100%;
  padding: 14px;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  margin-top: 10px;
}

.btn-primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
}

.btn-secondary {
  background: #6c757d;
  color: white;
}

.btn-secondary:hover {
  background: #5a6268;
}

.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none !important;
}

.status {
  margin-top: 15px;
  padding: 12px;
  border-radius: 8px;
  font-weight: 500;
  display: none;
}

.status.success {
  background: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
  display: block;
}

.status.error {
  background: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
  display: block;
}

.status.info {
  background: #d1ecf1;
  color: #0c5460;
  border: 1px solid #bee5eb;
  display: block;
}

/* Modal */
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.5);
  animation: fadeIn 0.3s;
  overflow-y: auto;
}

.modal-content {
  background: white;
  margin: 5% auto;
  padding: 30px;
  border-radius: 15px;
  max-width: 600px;
  animation: slideDown 0.3s;
  max-height: 90vh;
  overflow-y: auto;
}

@keyframes slideDown {
  from { opacity: 0; transform: translateY(-50px); }
  to { opacity: 1; transform: translateY(0); }
}

.modal-header {
  margin-bottom: 20px;
}

.modal-header h3 {
  color: #667eea;
  font-size: 1.3em;
}

.close {
  float: right;
  font-size: 28px;
  font-weight: bold;
  color: #999;
  cursor: pointer;
  line-height: 20px;
}

.close:hover {
  color: #333;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}

th, td {
  padding: 12px;
  text-align: left;
  border-bottom: 1px solid #e0e0e0;
  font-size: 14px;
}

th {
  background: #f8f9fa;
  color: #667eea;
  font-weight: 600;
}

tr:hover {
  background: #f8f9fa;
}

.grid-2 {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
}

/* Tabs */
.tabs {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  border-bottom: 2px solid #e0e0e0;
}

.tab {
  padding: 12px 24px;
  background: transparent;
  border: none;
  border-bottom: 3px solid transparent;
  cursor: pointer;
  font-size: 15px;
  font-weight: 500;
  color: #666;
  transition: all 0.3s;
}

.tab:hover {
  color: #667eea;
}

.tab.active {
  color: #667eea;
  border-bottom-color: #667eea;
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
  animation: fadeIn 0.3s;
}

/* Upload Area */
.file-upload-area {
  border: 3px dashed #e0e0e0;
  border-radius: 8px;
  padding: 30px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s;
  margin: 15px 0;
}

.file-upload-area:hover {
  border-color: #667eea;
  background: #f8f9fa;
}

.file-upload-area.active {
  border-color: #667eea;
  background: rgba(102, 126, 234, 0.05);
}

/* Text Paste Area */
.text-paste-area {
  margin: 15px 0;
}

.text-paste-area textarea {
  min-height: 200px;
  resize: vertical;
  font-family: 'Courier New', monospace;
  font-size: 13px;
}

#filePreview, #textPreview {
  margin-top: 15px;
  font-size: 14px;
  color: #666;
}

.badge {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
}

.badge-energia {
  background: #fff3cd;
  color: #856404;
}

.badge-agua {
  background: #d1ecf1;
  color: #0c5460;
}

.helper-text {
  font-size: 12px;
  color: #666;
  margin-top: 5px;
  display: block;
}

@media (max-width: 768px) {
  .grid-2 {
    grid-template-columns: 1fr;
  }
  
  h1 {
    font-size: 1.5em;
  }
  
  .card {
    padding: 20px;
  }
  
  .modal-content {
    margin: 2% auto;
    padding: 20px;
  }
  
  .tabs {
    flex-direction: column;
    gap: 5px;
  }
  
  .tab {
    text-align: left;
    border-bottom: 1px solid #e0e0e0;
  }
}
</style>

</head>
<body>

<div class="container">
  <h1>‚ö° Sistema de Gest√£o de Faturas</h1>

  <!-- ================= CADASTRO MANUAL ================= -->
  <div class="card">
    <h2>üìù Cadastro Manual de Fatura</h2>
    
    <div class="form-group">
      <label>Tipo de Fatura</label>
      <select id="tipo">
        <option value="Energia">‚ö° Energia</option>
        <option value="√Ågua">üíß √Ågua</option>
      </select>
    </div>

    <div class="form-group">
      <label>Nome do Cliente</label>
      <input id="cliente" placeholder="Ex: Jo√£o Silva">
    </div>

    <div class="grid-2">
      <div class="form-group">
        <label>CPF</label>
        <input id="cpf" placeholder="000.000.000-00" maxlength="14">
      </div>
      <div class="form-group">
        <label>Matr√≠cula</label>
        <input id="matricula" placeholder="Ex: 123456">
      </div>
    </div>

    <div class="grid-2">
      <div class="form-group">
        <label>M√™s/Ano de Refer√™ncia</label>
        <input id="referencia" placeholder="Ex: 01/2026">
      </div>
      <div class="form-group">
        <label>Data de Emiss√£o</label>
        <input type="date" id="emissao">
      </div>
    </div>

    <div class="grid-2">
      <div class="form-group">
        <label>Data de Vencimento</label>
        <input type="date" id="vencimento">
      </div>
      <div class="form-group">
        <label>Consumo (kWh ou m¬≥)</label>
        <input id="consumo" type="number" step="0.01" placeholder="Ex: 350">
      </div>
    </div>

    <div class="grid-2">
      <div class="form-group">
        <label>Valor (R$)</label>
        <input id="valor" type="number" step="0.01" placeholder="Ex: 250.50">
      </div>
      <div class="form-group">
        <label>Bandeira / Tarifa</label>
        <input id="bandeira" placeholder="Ex: Vermelha">
      </div>
    </div>

    <div class="form-group">
      <label>C√≥digo PIX</label>
      <input id="pix" placeholder="C√≥digo PIX para pagamento">
    </div>

    <div class="form-group">
      <label>Observa√ß√µes</label>
      <textarea id="obs" rows="3" placeholder="Informa√ß√µes adicionais"></textarea>
    </div>

    <button class="btn btn-primary" onclick="salvarFatura()">üíæ Salvar Fatura</button>
    <div class="status" id="msgCadastro"></div>
  </div>

  <!-- ================= OCR COM DI√ÅLOGO E COLAR TEXTO ================= -->
  <div class="card">
    <h2>ü§ñ Upload de Fatura (OCR Autom√°tico)</h2>
    
    <p style="color: #666; margin-bottom: 20px;">
      Fa√ßa upload de sua fatura em PDF/imagem ou cole o texto extra√≠do.
    </p>

    <button class="btn btn-primary" onclick="abrirDialogoUpload()">
      üì§ Iniciar Upload de Fatura
    </button>

    <div class="status" id="msgOCR"></div>
  </div>

  <!-- ================= PAINEL ================= -->
  <div class="card">
    <h2>üìä Hist√≥rico de Faturas</h2>
    <button class="btn btn-secondary" onclick="carregar()">üîÑ Atualizar Lista</button>

    <div style="overflow-x: auto;">
      <table id="tabela">
        <thead>
          <tr>
            <th>Tipo</th>
            <th>Cliente</th>
            <th>Refer√™ncia</th>
            <th>Vencimento</th>
            <th>Consumo</th>
            <th>Valor</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td colspan="6" style="text-align: center; color: #999;">
              Carregando dados...
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<!-- ================= MODAL DE UPLOAD ================= -->
<div id="modalUpload" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <span class="close" onclick="fecharModal()">&times;</span>
      <h3>üì§ Informa√ß√µes da Fatura</h3>
    </div>

    <div class="form-group">
      <label>Qual tipo de fatura voc√™ vai enviar?</label>
      <select id="tipoFatura">
        <option value="Energia">‚ö° Energia El√©trica</option>
        <option value="√Ågua">üíß √Ågua e Esgoto</option>
      </select>
    </div>

    <div class="form-group">
      <label>M√™s e Ano de Refer√™ncia</label>
      <input type="month" id="mesAnoReferencia" required>
      <small class="helper-text">Selecione o m√™s/ano da fatura</small>
    </div>

    <!-- TABS: Upload ou Colar Texto -->
    <div class="tabs">
      <button class="tab active" onclick="mudarTab('upload')">
        üìÅ Upload de Arquivo
      </button>
      <button class="tab" onclick="mudarTab('texto')">
        üìã Colar Texto
      </button>
    </div>

    <!-- TAB: Upload de Arquivo -->
    <div id="tabUpload" class="tab-content active">
      <div class="form-group">
        <label>Selecione o arquivo da fatura</label>
        <div class="file-upload-area" id="dropArea" onclick="document.getElementById('arquivoFatura').click()">
          <div style="font-size: 48px; margin-bottom: 10px;">üìÑ</div>
          <p><strong>Clique para selecionar</strong> ou arraste o arquivo aqui</p>
          <p style="font-size: 12px; color: #999; margin-top: 10px;">
            Formatos aceitos: PDF, JPG, PNG (m√°x. 10MB)
          </p>
        </div>
        <input type="file" id="arquivoFatura" accept="application/pdf,image/jpeg,image/png,image/jpg" style="display: none;">
        <div id="filePreview"></div>
      </div>
    </div>

    <!-- TAB: Colar Texto -->
    <div id="tabTexto" class="tab-content">
      <div class="form-group text-paste-area">
        <label>Cole aqui o texto da fatura</label>
        <textarea id="textoColado" placeholder="Cole aqui todo o texto da sua fatura extra√≠do de PDF ou imagem...

Exemplo:
CPFL ENERGIA
CPF: 123.456.789-00
Matr√≠cula: 987654
Refer√™ncia: 01/2026
Vencimento: 05/02/2026
Consumo: 350 kWh
Valor Total: R$ 250,50"></textarea>
        <small class="helper-text">
          üí° Dica: Use Ctrl+A para selecionar tudo no PDF, depois Ctrl+C para copiar e Ctrl+V para colar aqui
        </small>
        <div id="textPreview"></div>
      </div>
    </div>

    <button class="btn btn-primary" id="btnProcessar" onclick="processarFatura()" disabled>
      üöÄ Processar Fatura
    </button>
    <button class="btn btn-secondary" onclick="fecharModal()">
      ‚úï Cancelar
    </button>
  </div>
</div>

<script>
// üî¥ COLE AQUI A URL DO SEU APPS SCRIPT
const API ='https://script.google.com/macros/s/AKfycbx48-kV1G1AfaQU_H8y3M349f_cX5eNmjUr59JMLmvdlbyrJU-b3PFLdeO9iZ0d-Eqt/exec';

// ================= VARI√ÅVEIS GLOBAIS =================
let arquivoSelecionado = null;
let textoColadoAtual = '';
let modoAtual = 'upload'; // 'upload' ou 'texto'

// ================= M√ÅSCARAS E VALIDA√á√ïES =================
document.getElementById('cpf').addEventListener('input', function(e) {
  let value = e.target.value.replace(/\D/g, '');
  if (value.length <= 11) {
    value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
    e.target.value = value;
  }
});

document.getElementById('referencia').addEventListener('input', function(e) {
  let value = e.target.value.replace(/\D/g, '');
  if (value.length <= 6) {
    value = value.replace(/(\d{2})(\d{4})/, '$1/$2');
    e.target.value = value;
  }
});

// Monitorar texto colado
document.getElementById('textoColado').addEventListener('input', function(e) {
  textoColadoAtual = e.target.value.trim();
  const textPreview = document.getElementById('textPreview');
  const btnProcessar = document.getElementById('btnProcessar');
  
  if (textoColadoAtual.length > 10) {
    const linhas = textoColadoAtual.split('\n').length;
    const chars = textoColadoAtual.length;
    textPreview.innerHTML = `
      <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px;">
        <p><strong>üìù Texto detectado</strong></p>
        <p style="color: #666; font-size: 12px;">
          ${linhas} linhas ‚Ä¢ ${chars} caracteres
        </p>
      </div>
    `;
    btnProcessar.disabled = false;
  } else {
    textPreview.innerHTML = '';
    btnProcessar.disabled = true;
  }
});

// ================= TABS =================
function mudarTab(tipo) {
  // Atualizar tabs
  document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
  
  if (tipo === 'upload') {
    document.querySelectorAll('.tab')[0].classList.add('active');
    document.getElementById('tabUpload').classList.add('active');
    modoAtual = 'upload';
    
    // Habilitar bot√£o se arquivo j√° selecionado
    if (arquivoSelecionado) {
      document.getElementById('btnProcessar').disabled = false;
    } else {
      document.getElementById('btnProcessar').disabled = true;
    }
  } else {
    document.querySelectorAll('.tab')[1].classList.add('active');
    document.getElementById('tabTexto').classList.add('active');
    modoAtual = 'texto';
    
    // Habilitar bot√£o se texto j√° colado
    if (textoColadoAtual.length > 10) {
      document.getElementById('btnProcessar').disabled = false;
    } else {
      document.getElementById('btnProcessar').disabled = true;
    }
  }
}

// ================= CADASTRO MANUAL =================
function salvarFatura() {
  const msgDiv = document.getElementById('msgCadastro');
  
  // Valida√ß√£o b√°sica
  if (!cliente.value || !vencimento.value || !valor.value) {
    msgDiv.className = 'status error';
    msgDiv.innerHTML = '‚ö†Ô∏è Preencha pelo menos: Cliente, Vencimento e Valor';
    return;
  }

  const dados = {
    acao: 'cadastrar',
    tipo: tipo.value,
    cliente: cliente.value,
    cpf: cpf.value,
    matricula: matricula.value,
    referencia: referencia.value,
    emissao: emissao.value,
    vencimento: vencimento.value,
    consumo: consumo.value,
    valor: valor.value,
    bandeira: bandeira.value,
    pix: pix.value,
    obs: obs.value
  };

  msgDiv.className = 'status info';
  msgDiv.innerHTML = '‚è≥ Salvando fatura...';

  fetch(API, {
    method: 'POST',
    mode: 'no-cors',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(dados)
  })
  .then(() => {
    msgDiv.className = 'status success';
    msgDiv.innerHTML = '‚úÖ Fatura salva com sucesso!';
    limparFormulario();
    setTimeout(() => {
      carregar();
      msgDiv.style.display = 'none';
    }, 2000);
  })
  .catch(err => {
    msgDiv.className = 'status success';
    msgDiv.innerHTML = '‚úÖ Fatura enviada! (Modo no-cors)';
    limparFormulario();
    setTimeout(() => {
      carregar();
      msgDiv.style.display = 'none';
    }, 2000);
  });
}

function limparFormulario() {
  cliente.value = '';
  cpf.value = '';
  matricula.value = '';
  referencia.value = '';
  emissao.value = '';
  vencimento.value = '';
  consumo.value = '';
  valor.value = '';
  bandeira.value = '';
  pix.value = '';
  obs.value = '';
}

// ================= MODAL DE UPLOAD =================
function abrirDialogoUpload() {
  document.getElementById('modalUpload').style.display = 'block';
  
  // Preencher com m√™s atual por padr√£o
  const hoje = new Date();
  const mesAtual = String(hoje.getMonth() + 1).padStart(2, '0');
  const anoAtual = hoje.getFullYear();
  document.getElementById('mesAnoReferencia').value = `${anoAtual}-${mesAtual}`;
  
  // Resetar para tab de upload
  mudarTab('upload');
}

function fecharModal() {
  document.getElementById('modalUpload').style.display = 'none';
  document.getElementById('arquivoFatura').value = '';
  document.getElementById('textoColado').value = '';
  document.getElementById('filePreview').innerHTML = '';
  document.getElementById('textPreview').innerHTML = '';
  document.getElementById('btnProcessar').disabled = true;
  arquivoSelecionado = null;
  textoColadoAtual = '';
}

// ================= DRAG AND DROP =================
const dropArea = document.getElementById('dropArea');

['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
  dropArea.addEventListener(eventName, preventDefaults, false);
});

function preventDefaults(e) {
  e.preventDefault();
  e.stopPropagation();
}

['dragenter', 'dragover'].forEach(eventName => {
  dropArea.addEventListener(eventName, () => {
    dropArea.classList.add('active');
  }, false);
});

['dragleave', 'drop'].forEach(eventName => {
  dropArea.addEventListener(eventName, () => {
    dropArea.classList.remove('active');
  }, false);
});

dropArea.addEventListener('drop', handleDrop, false);

function handleDrop(e) {
  const dt = e.dataTransfer;
  const files = dt.files;
  
  if (files.length > 0) {
    document.getElementById('arquivoFatura').files = files;
    handleFileSelect();
  }
}

// ================= SELE√á√ÉO DE ARQUIVO =================
document.getElementById('arquivoFatura').addEventListener('change', handleFileSelect);

function handleFileSelect() {
  const fileInput = document.getElementById('arquivoFatura');
  const file = fileInput.files[0];
  const previewDiv = document.getElementById('filePreview');
  
  if (!file) {
    return;
  }

  // Validar tamanho (10MB)
  if (file.size > 10 * 1024 * 1024) {
    previewDiv.innerHTML = '<p style="color: red;">‚ùå Arquivo muito grande! M√°ximo: 10MB</p>';
    document.getElementById('btnProcessar').disabled = true;
    return;
  }

  // Validar tipo
  const tiposPermitidos = ['application/pdf', 'image/jpeg', 'image/png', 'image/jpg'];
  if (!tiposPermitidos.includes(file.type)) {
    previewDiv.innerHTML = '<p style="color: red;">‚ùå Formato n√£o suportado!</p>';
    document.getElementById('btnProcessar').disabled = true;
    return;
  }

  arquivoSelecionado = file;
  
  const tamanhoMB = (file.size / (1024 * 1024)).toFixed(2);
  const icone = file.type === 'application/pdf' ? 'üìÑ' : 'üñºÔ∏è';
  
  previewDiv.innerHTML = `
    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 10px;">
      <p><strong>${icone} ${file.name}</strong></p>
      <p style="color: #666; font-size: 12px;">Tamanho: ${tamanhoMB} MB</p>
    </div>
  `;
  
  document.getElementById('btnProcessar').disabled = false;
}

// ================= PROCESSAR FATURA =================
function processarFatura() {
  const tipoFatura = document.getElementById('tipoFatura').value;
  const mesAno = document.getElementById('mesAnoReferencia').value;
  const msgDiv = document.getElementById('msgOCR');
  
  if (!mesAno) {
    alert('Por favor, selecione o m√™s e ano de refer√™ncia!');
    return;
  }

  // Converter m√™s/ano para formato brasileiro
  const [ano, mes] = mesAno.split('-');
  const referenciaFormatada = `${mes}/${ano}`;

  msgDiv.className = 'status info';
  msgDiv.innerHTML = '‚è≥ Processando fatura... Por favor, aguarde.';

  if (modoAtual === 'texto') {
    // Processar texto colado
    if (!textoColadoAtual || textoColadoAtual.length < 10) {
      alert('Por favor, cole um texto v√°lido!');
      return;
    }

    const dados = {
      acao: 'ocr-texto',
      texto: textoColadoAtual,
      tipo: tipoFatura,
      referencia: referenciaFormatada
    };

    fetch(API, {
      method: 'POST',
      mode: 'no-cors',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify(dados)
    })
    .then(() => {
      msgDiv.className = 'status success';
      msgDiv.innerHTML = `‚úÖ Fatura de ${tipoFatura} (${referenciaFormatada}) processada com sucesso via texto!`;
      fecharModal();
      setTimeout(() => {
        carregar();
        msgDiv.style.display = 'none';
      }, 3000);
    })
    .catch(() => {
      msgDiv.className = 'status success';
      msgDiv.innerHTML = `‚úÖ Fatura de ${tipoFatura} (${referenciaFormatada}) enviada! (Modo no-cors)`;
      fecharModal();
      setTimeout(() => {
        carregar();
        msgDiv.style.display = 'none';
      }, 3000);
    });

  } else {
    // Processar arquivo
    if (!arquivoSelecionado) {
      alert('Por favor, selecione um arquivo!');
      return;
    }

    const reader = new FileReader();

    reader.onload = function() {
      const dados = {
        acao: 'ocr-arquivo',
        arquivo: reader.result,
        nome: arquivoSelecionado.name,
        tipo: tipoFatura,
        referencia: referenciaFormatada
      };

      fetch(API, {
        method: 'POST',
        mode: 'no-cors',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(dados)
      })
      .then(() => {
        msgDiv.className = 'status success';
        msgDiv.innerHTML = `‚úÖ Fatura de ${tipoFatura} (${referenciaFormatada}) processada com sucesso!`;
        fecharModal();
        setTimeout(() => {
          carregar();
          msgDiv.style.display = 'none';
        }, 3000);
      })
      .catch(() => {
        msgDiv.className = 'status success';
        msgDiv.innerHTML = `‚úÖ Fatura de ${tipoFatura} (${referenciaFormatada}) enviada! (Modo no-cors)`;
        fecharModal();
        setTimeout(() => {
          carregar();
          msgDiv.style.display = 'none';
        }, 3000);
      });
    };

    reader.readAsDataURL(arquivoSelecionado);
  }
}

// ================= PAINEL =================
function carregar() {
  fetch(API)
    .then(r => r.json())
    .then(dados => {
      const tbody = document.querySelector('#tabela tbody');
      tbody.innerHTML = '';

      if (!dados || dados.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #999;">Nenhuma fatura cadastrada</td></tr>';
        return;
      }

      dados.forEach(l => {
        const tr = document.createElement('tr');
        const tipo = l[1];
        const badgeClass = tipo === 'Energia' ? 'badge-energia' : 'badge-agua';
        
        tr.innerHTML = `
          <td><span class="badge ${badgeClass}">${tipo}</span></td>
          <td>${l[2] || '-'}</td>
          <td>${l[5] || '-'}</td>
          <td>${l[7] || '-'}</td>
          <td>${l[8] || '-'}</td>
          <td>R$ ${l[9] || '0.00'}</td>
        `;
        tbody.appendChild(tr);
      });
    })
    .catch(err => {
      const tbody = document.querySelector('#tabela tbody');
      tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #999;">Configure a URL da API para ver os dados</td></tr>';
    });
}

// Fechar modal ao clicar fora
window.onclick = function(event) {
  const modal = document.getElementById('modalUpload');
  if (event.target === modal) {
    fecharModal();
  }
}

// Carregar dados ao iniciar
carregar();
</script>

</body>
</html>
